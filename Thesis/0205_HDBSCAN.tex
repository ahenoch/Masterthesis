\section{HDBSCAN} \label{sec:HDBSCAN}

\gls{HDBSCAN} is an clustering algorithm proposed by \textcite{campello_hierarchical_2015, hutchison_density-based_2013}. It is a novel version of \gls{DBSCAN} but executed with varying values of $\varepsilon$ \autocite{hutchison_density-based_2013}. Thus not one specific threshold is used to define the clusters, but instead clusters of varying densities are extracted based on their stability over epsilon \autocite{mcinnes_hdbscan_2017}. The version of \gls{HDBSCAN} used in this project is the accelerated implementation of \textcite{mcinnes_accelerated_2017} (\autoref{fig:Clustering_Pipeline} \textsf{\textbf{F}}).

Since there is, to my best knowledge, no submission using \gls{HDBSCAN} for a usecase similar to the one proposed in this project, most settings for \gls{HDBSCAN} were selected by parameter exploration, graphical comparisons and reasonable assumptions. For the selection of all settings the \href{https://hdbscan.readthedocs.io/en/latest/api.html}{API} was used as backup \autocite{mcinnes_hdbscan_2017}. 

To capture, in the best case, even genomes with single \glspl{SNP} at rare appearing positions in their own clusters \colorbox{backcolour}{min\_cluster\_size=2} and \colorbox{backcolour}{min\_samples=1} setting was used as default in the project. These settings are in both cases the smallest values possible, to declare as least points as possible as noise. Setting the \gls{UMAP} parameters to focus on the global structure, while cluster as fine as possible might sound contradictory and is therefore discussed in \autoref{sec:Dimension_Reduction}. The default \colorbox{backcolour}{metric='euclidean'} setting was used to approximate the use of cosine distance metric as described in \autoref{sec:Normalization}. For calculation of the linkage matrix $\mathbf{L}$ standard \gls{HDBSCAN} without $\varepsilon$ was used.

\autoref{eq:HDB} to \autoref{eq:HDB_link_X} demonstrate the use of \gls{HDBSCAN} to calculate the linkage matrix $\mathbf{L}$ with matrix $\mathbf{X}_{(30)}$ of \autoref{fig:Clustering_Pipeline} pathway \textsf{\textbf{1}} and was performed in the same way with $\mathbf{Y}$ of \autoref{fig:Clustering_Pipeline} pathway \textsf{\textbf{2}} \autocite{mcinnes_hdbscan_2017, gower_minimum_1969}.

\begin{empheq}{alignat = -1}
    &\mathbf{L} &&= \text{HDBSCAN}_{\text{Link}}(\mathbf{X}, \text{min\_cluster\_size}, \text{min\_samples})\label{eq:HDB}\\
    &&&= \text{HDBSCAN}_{\text{Link}}(\mathbf{X}_{(30)}, 2, 1) \label{eq:HDB_link_X}
\end{empheq}

By combining \gls{HDBSCAN} with \gls{DBSCAN} some of the disadvantages of using either of these methods can be overcome \autocite{mcinnes_hdbscan_2017, moulavi_density-based_2014}. Since \gls{DBSCAN} is a hierarchical clustering tool, it is dependent on a strict threshold for clustering. Points not included in this threshold value are omitted \autocite{ester_density-based_1996, schubert_dbscan_2017}. \gls{HDBSCAN} on the other hand tend to create micro-clusters in areas of high density \autocite{mcinnes_hdbscan_2017}. Using the hybrid approach proposed in \autocite{malzer_hybrid_2020} a threshold value $\varepsilon$ can be used to extract clusters but still use the method of \gls{HDBSCAN} instead of emitting other points. This method is useful when having a small cluster size value while still want to cluster high-density areas together \autocite{malzer_hybrid_2020}.

To find an appropriate value for $\varepsilon$ two different methods were used and compared (\autoref{fig:Clustering_Pipeline} pathway \textsf{\textbf{3}} and \textsf{\textbf{4}}. Using the first method, the \gls{DBCV} exploration in \autoref{fig:Clustering_Pipeline} \textsf{\textbf{G}}, execution of \gls{HDBSCAN} was repeated with different settings for $\varepsilon$ and compared by the \gls{DBCV} to find $\varepsilon$ to maximize the \gls{DBCV} \autocite{moulavi_density-based_2014}. For these repeated executions of \gls{HDBSCAN}, \colorbox{backcolour}{gen\_min\_span\_tree=True} setting was also necessary, to be able to calculate the \gls{DBCV}, by the minimum spanning tree \autocite{moulavi_density-based_2014, gower_minimum_1969}.

\begin{empheq}{alignat = -1}
    &\varepsilon : \max_{\substack{0 \leq \varepsilon}} \text{HDBSCAN}_{\text{DBCV}}(\mathbf{X}, 2, 1, \varepsilon)\label{eq:DBCV}
    %&\varepsilon : \text{DBCV}_{\text{max}} &&= \text{HDBSCAN}_{\text{DBCV}}(\mathbf{X}, 2, 1, \varepsilon)\label{eq:DBCV}
\end{empheq}

Using the second method the optimal value for $\varepsilon$ was calculated using the Kneedle algorithm \autoref{sec:Kneedle} \autocite{halko_finding_2010}.

Repeating the execution of \gls{HDBSCAN} with the hybrid clustering using optimal values for $\varepsilon$ results in the mathematical sequence of cluster names $C$ matching the genomics sequences in $S$ (\autoref{fig:Clustering_Pipeline} \textsf{\textbf{H}}) \autocite{mcinnes_hdbscan_2017, malzer_hybrid_2020}.

\begin{empheq}{alignat = -1}
    &C &&= \text{HDBSCAN}_{\text{Hybrid}}(\mathbf{X}, 2, 1, \varepsilon) \label{eq:HDB_cluster}\\
    &&&= (0, 0, 0, 1, 2, 1, 4, 5, \ldots)
\end{empheq}

The parameters used in this project with settings varying from the default are listed below. All available settings can be fount in the \href{https://hdbscan.readthedocs.io/en/latest/api.html}{API}.

\begin{leftbar}
    \textbf{hdbscan.HDBSCAN}
    \begin{nstabbing}
        \qquad\qquad\qquad\qquad\qquad\quad\=\kill

        min\_cluster\_size \> (default: 5)\\
        
        min\_samples \> (default: None)\\
        
        cluster\_selection\_epsilon \> (default: 0.0)\\
        
        gen\_min\_span\_tree \> (default: False)\\
        
        metric \> (default: euclidean)
        %alpha \> (default: 1.0)
    \end{nstabbing}
\end{leftbar}

%Clustering
%DBCV mehr als 50dims abkacken bla
%Metrik
%Hybrid selection
%Needle
%Linkage matrix